# Домашнее задание №1
## Тема: Основы работы с Kubernetes (часть 2)

**Задание:**
* Создать минимальный сервис, который:
    1. Отвечает на порту 8000
    2. Имеет http-метод
        ```
        GET /health/
        RESPONSE: {"status": "OK"}
        ```
* Cобрать локально образ приложения в докер.
* Запушить образ в dockerhub
* Написать манифесты для деплоя в k8s для этого сервиса.

**Требования:**
* Манифесты должны описывать сущности Deployment, Service, Ingress.
* В Deployment обязательно должны быть указаны Liveness, Readiness пробы.
* Количество реплик должно быть не меньше 2. Image контейнера должен быть указан с Dockerhub.
* В Ingress-е должно быть правило, которое форвардит все запросы с `'/otusapp/{student name}/*'` на сервис с rewrite-ом пути. Где `'{student name}'` - это имя студента.
* Хост в ингрессе должен быть `'arch.homework'`. В итоге после применения манифестов GET запрос на `'http://arch.homework/otusapp/{student name}/health'` должен отдавать `'{“status”: “OK”}'`.

**На выходе предоставить:**
1. Ссылку на github c манифестами. Манифесты должны лежать в одной директории, так чтобы можно было их все применить одной командой `'kubectl apply -f .'`
2. url, по которому можно будет получить ответ от сервиса (либо тест в postmanе).

---

## Решение
Приложение будет развёртываться в **minikube**, на локальной ВМ с ubuntu 18.04 server

Создадим простой сервис на flask и поместим его в папку [app](app/) вместе с файлом зависимостей requirements.txt. Наш сервис будет запускаться на порту 8000 и имеет метод `'/health/'`, возвращающий статус.

Для сборки образа создадим Dockerfile на основе `'python:alpine'`. Саму сборку выполняем командой `'docker build -t drsklifnsk/otus-sa:simple-app-v1 .'`
> Перед отправкой образа в dockerhub необходимо в нём авторизоваться командой `'docker login'`

Отправку образа в dockerhub выполняем командой `'docker push drsklifnsk/otus-sa:simple-app-v1'`

Все необходимые манифесты находятся в папке [manifests](manifests/). Для удобства развёртывания воспользуемся утилитой **skaffold**:
* `'skaffold init'` - команда для создания манифеста развёртывания
* `'skaffold run'` - для запуска развёртывания

Для выполнения запроса по домену `'arch.homework'` нужно добавить запись в `'/etc/hosts'`. В моём случае получилась запись следующего вида `'172.17.0.2 arch.homework'`, где `'172.17.0.2'` - адрес по которому нужно отправлять запросы в миникуб. Узнать его можно командой `'minikube ip'`.

После всех настроек можно выполнить запрос к сервису по адресу [http://arch.homework/otusapp/ildyakov-aleksandr/health/](http://arch.homework/otusapp/ildyakov-aleksandr/health/)